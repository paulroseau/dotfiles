# Helpers

has() { (( $+commands[$1] )); }
is_interactive() { [[ -o interactive ]]; }

# Environment variable (including PATH)
[[ -r "$HOME/.env"     ]] && . "$HOME/.env"
[[ -r "$HOME/.aliases" ]] && . "$HOME/.aliases"

export SHELL="zsh"


# Prompt and Zoxide (interactive only)
if is_interactive; then
  has starship && eval "$(starship init zsh)"
  has zoxide   && eval "$(zoxide init zsh)"
fi

# History
HISTSIZE=10000
SAVEHIST=10000
HISTFILE="$HOME/.zsh_history"
setopt APPEND_HISTORY SHARE_HISTORY HIST_SAVE_NO_DUPS EXTENDED_HISTORY

# Default keymap

# Zsh sets keymap to vi if the EDITOR environment variable is set to nvim.
# Because the emulation is not exact, it is better to use default emacs bindings
# and resort to full on nvim if advanced editing is needed (cf. edit-command-line)
bindkey -e

# Edit current command in editor
autoload -Uz edit-command-line
zle -N edit-command-line
bindkey -M main '^v' edit-command-line

# Completion
zstyle ':completion:*' menu select

# Navigate completion menu with vi style bindings
zmodload zsh/complist
bindkey -M menuselect 'h' vi-backward-char
bindkey -M menuselect 'l' vi-forward-char
bindkey -M menuselect 'k' vi-up-line-or-history
bindkey -M menuselect 'j' vi-down-line-or-history

# Add zsh completion for nix installed tools
if [ -e $ZSH_PLUGINS_DIR/zsh/site-functions ]; then fpath+=($ZSH_PLUGINS_DIR/zsh/site-functions $fpath); fi

# Init completion
autoload -Uz compinit
compinit

# FZF key bindings and autocomplete (needs to happen after completion initialization)
[ -r $FZF_SHELL_DIR/completion.zsh ] && . $FZF_SHELL_DIR/completion.zsh
[ -r $FZF_SHELL_DIR/key-bindings.zsh ] && . $FZF_SHELL_DIR/key-bindings.zsh

# Zsh plugins
[ -r $ZSH_PLUGINS_DIR/zsh-autosuggestions/zsh-autosuggestions.zsh ] && . $ZSH_PLUGINS_DIR/zsh-autosuggestions/zsh-autosuggestions.zsh
[ -r $ZSH_PLUGINS_DIR/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ] && . $ZSH_PLUGINS_DIR/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
